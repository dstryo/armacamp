(()=>{"use strict";var e,r,t,o,n={480:(e,r,t)=>{t.a(e,(async(e,r)=>{try{var t=O(require("fs")),o=O(require("express")),n=O(require("express-promise-router")),i=require("vite"),a=O(require("./vite.config.js")),c=O(require("@geckos.io/server")),s=O(require("http"));function O(e){return e&&e.__esModule?e:{default:e}}function g(e){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},g(e)}function S(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,o)}return t}function w(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?S(Object(t),!0).forEach((function(r){var o,n,i,a;o=e,n=r,i=t[r],(n="symbol"==g(a=j(n,"string"))?a:a+"")in o?Object.defineProperty(o,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[n]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):S(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function j(e,r){if("object"!=g(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var o=t.call(e,r||"default");if("object"!=g(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}var u=(0,n.default)(),f={},l={},d="enemy"+Math.floor(1e6*Math.random()),m=await(0,i.createServer)(w({configFile:!1,server:{middlewareMode:"html"}},a.default));u.get("/",(function(e,r,o){t.default.readFile("./public/index.html","utf-8",(function(t,o){t?console.error(t):m.transformIndexHtml(e.url,o).then((function(e){r.send(e)}))}))})),u.use(m.middlewares),u.use("*",(function(e,r){r.status(404).send({message:"Not Found"})}));var p=(0,o.default)();p.use(u);var v=s.default.createServer(p),y=(0,c.default)();y.addServer(v);var b={},h=[];function x(){for(var e in h.push(JSON.parse(JSON.stringify(b))),h.length>10&&h.shift(),f){var r=f[e].map((function(e){return e.position})),t=f[e].map((function(e){return e.rotation})),o=f[e].map((function(e){return e.torsoRotation})),n=_(r),i=_(t),a=_(o);b[e]&&(b[e].position=n,b[e].rotation=i,b[e].torsoRotation=a,b[e].time=f[e][f[e].length-1].time)}}function _(e){var r=e.length;if(r<2)return e[r-1];for(var t=e[r-1],o=e[r-2],n=0;n<t.length;n++)t[n]=(t[n]+o[n])/2;return t}y.onConnection((function(e){console.log("User ".concat(e.id," connected")),b[e.id]={id:e.id,position:[2e3*(Math.random()-.5),2e3*(Math.random()-.5),200],rotation:[0,0,0],torsoRotation:[0,0,0],playerHealth:500},b[d]={id:d,enemyPosition:[100,0,0],enemyHealth:500},x();var r=Buffer.from(JSON.stringify(b));e.emit("gameState",r);var t=0;e.on("laser",(function(e){try{var r=Uint8Array.from(Object.values(e)),t=(new TextDecoder).decode(r),o=JSON.parse(t);l[o.id]=o;var n=Buffer.from(JSON.stringify(o));y.emit("laser",n)}catch(e){console.error("An error occurred:",e)}})),e.on("removeLaser",(function(e){var r=Uint8Array.from(Object.values(e)),t=(new TextDecoder).decode(r),o=JSON.parse(t);l[o.id]=o;var n=Buffer.from(JSON.stringify(o));delete l[e],y.emit("removeLaser",n)})),e.on("enemyHit",(function(e){try{var r=Uint8Array.from(Object.values(e)),t=(new TextDecoder).decode(r),o=JSON.parse(t);if(b[d]&&o===d){b[d].enemyHealth-=10,b[d].enemyHealth<=0&&delete b[d],o.laserId&&l[o.laserId]&&delete l[o.laserId];var n=Buffer.from(JSON.stringify(b));y.emit("gameState",n)}}catch(e){console.error("An error occurred:",e)}})),e.on("hit",(function(e){try{var r=Uint8Array.from(Object.values(e)),t=(new TextDecoder).decode(r),o=JSON.parse(t);if(b[o]){b[o].playerHealth-=10,b[o].playerHealth<=0&&delete b[o],o.laserId&&l[o.laserId]&&delete l[o.laserId];var n=Buffer.from(JSON.stringify(b));y.emit("gameState",n)}}catch(e){console.error("An error occurred:",e)}})),e.onDisconnect((function(){console.log("User ".concat(e.id," disconnected")),delete b[e.id]})),e.on("enemyMove",(function(e){try{var r=Uint8Array.from(Object.values(e)),o=(new TextDecoder).decode(r),n=JSON.parse(o),i=Date.now();if(i-t<300){var a=n.id,c=n.position;return n.rotation,n.torsoRotation,n.time,void(b[a]&&(b[a].enemyPosition=c))}t=i}catch(e){console.error("An error occurred:",e)}})),e.on("move",(function(e){try{var r=Uint8Array.from(Object.values(e)),o=(new TextDecoder).decode(r),n=JSON.parse(o),i=Date.now();if(i-t<300){var a=n.id,c=n.position,s=n.rotation,u=n.torsoRotation,f=n.time,l=h.find((function(e){return e.time===f}));if(l){var d=l[a];if(d){var m=getChanges(l,n);b[a]=applyChanges(b[a],m)}else d.position=c,d.rotation=s,d.torsoRotation=u}return void(b[a]&&(b[a].position=c,b[a].rotation=s,b[a].torsoRotation=u))}t=i}catch(e){console.error("An error occurred:",e)}})),setInterval((function(){x();var e=Buffer.from(JSON.stringify(b));y.emit("gameState",e)}),1)})),v.listen(process.env.PORT||4444,(function(){console.log("Listening on port http://localhost:4444...")})),r()}catch(N){r(N)}}),1)}},i={};function a(e){var r=i[e];if(void 0!==r)return r.exports;var t=i[e]={exports:{}};return n[e](t,t.exports,a),t.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",r="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",t="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",o=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},a.a=(n,i,a)=>{var c;a&&((c=[]).d=-1);var s,u,f,l=new Set,d=n.exports,m=new Promise(((e,r)=>{f=r,u=e}));m[r]=d,m[e]=e=>(c&&e(c),l.forEach(e),m.catch((e=>{}))),n.exports=m,i((n=>{var i;s=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[e])return n;if(n.then){var i=[];i.d=0,n.then((e=>{a[r]=e,o(i)}),(e=>{a[t]=e,o(i)}));var a={};return a[e]=e=>e(i),a}}var c={};return c[e]=e=>{},c[r]=n,c})))(n);var a=()=>s.map((e=>{if(e[t])throw e[t];return e[r]})),u=new Promise((r=>{(i=()=>r(a)).r=0;var t=e=>e!==c&&!l.has(e)&&(l.add(e),e&&!e.d&&(i.r++,e.push(i)));s.map((r=>r[e](t)))}));return i.r?u:a()}),(e=>(e?f(m[t]=e):u(d),o(c)))),c&&c.d<0&&(c.d=0)},a(480)})();